{"version":3,"sources":["../../src/mailer/query.js"],"names":["sgMail","require","makeQuery","handle","httpRequest","resp","getMailer","headers","statusCode","data","JSON","stringify","errorMessage","e","message","UniqueConstraintError","InvalidPropertyError","RequiredParameterError","Promise","resolve","reject","msgInfo","body","parse","template","setApiKey","process","env","SENDGRID_API_KEY","msg","to","email","from","name","subject","topic","text","html","send","then","catch","error"],"mappings":";;;;;;;AAAA;;;;AAEA;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,gBAAD,CAAtB;;AAEe,SAASC,SAAT,GAAsB;AAEjC,SAAO,eAAeC,MAAf,CAAsBC,WAAtB,EAAkC;AACrC,QAAIC,IAAI,GAAG,MAAMC,SAAS,CAACF,WAAD,CAA1B;;AACA,QAAGC,IAAI,IAAI,IAAX,EAAgB;AACZ,aAAO;AACHE,QAAAA,OAAO,EAAE;AACP,0BAAgB;AADT,SADN;AAIHC,QAAAA,UAAU,EAAE,GAJT;AAKHC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeN,IAAf;AALH,OAAP;AAOH,KARD,MASK;AACD,aAAO,wBAAc;AACjBO,QAAAA,YAAY,EAAEC,CAAC,CAACC,OADC;AAEjBN,QAAAA,UAAU,EACRK,CAAC,YAAYE,qBAAb,GACI,GADJ,GAEIF,CAAC,YAAYG,oBAAb,IACAH,CAAC,YAAYI,sBADb,GAEE,GAFF,GAGE;AARS,OAAd,CAAP;AAUH;AAEJ,GAxBD;;AA0BA,iBAAeX,SAAf,CAA0BF,WAA1B,EAAuC;AACnC,WAAO,IAAIc,OAAJ,CAAY,CAACC,OAAD,EAASC,MAAT,KAAkB;AACjC,UAAIC,OAAO,GAAGjB,WAAW,CAACkB,IAA1B;;AAEA,UAAI,CAACD,OAAL,EAAc;AACV,eAAO,wBAAc;AACrBb,UAAAA,UAAU,EAAE,GADS;AAErBI,UAAAA,YAAY,EAAE;AAFO,SAAd,CAAP;AAIH;;AAED,UAAI,OAAOR,WAAW,CAACkB,IAAnB,KAA4B,QAAhC,EAA0C;AACtC,YAAI;AACAD,UAAAA,OAAO,GAAGX,IAAI,CAACa,KAAL,CAAWF,OAAX,CAAV;AACH,SAFD,CAEE,MAAM;AACR,iBAAO,wBAAc;AACjBb,YAAAA,UAAU,EAAE,GADK;AAEjBI,YAAAA,YAAY,EAAE;AAFG,WAAd,CAAP;AAIC;AACJ;AAID;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGY,YAAMY,QAAQ,GAAI;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4HAvC6B,GAuCgGH,OAAO,CAACP,OAvCxG,GAuCiH;AAC9I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBApEY;AAsEAd,MAAAA,MAAM,CAACyB,SAAP,CAAiBC,OAAO,CAACC,GAAR,CAAYC,gBAA7B;AACA,YAAMC,GAAG,GAAG;AACZC,QAAAA,EAAE,EAAET,OAAO,CAACU,KADA;AACO;AACnBC,QAAAA,IAAI,EAAE;AACFD,UAAAA,KAAK,EAAE,mBADL;AAEFE,UAAAA,IAAI,EAAE;AAFJ,SAFM;AAOZC,QAAAA,OAAO,EAAEb,OAAO,CAACc,KAPL;AAQZC,QAAAA,IAAI,EAAEf,OAAO,CAACP,OARF;AAQW;AACvBuB,QAAAA,IAAI,EAAEb,QATM,CASI;;AATJ,OAAZ;AAWAxB,MAAAA,MAAM,CACLsC,IADD,CACMT,GADN,EAECU,IAFD,CAEM,MAAM;AACRpB,QAAAA,OAAO,CAAC,IAAD,CAAP;AACH,OAJD,EAKCqB,KALD,CAKQC,KAAD,IAAW;AACdtB,QAAAA,OAAO,CAAC,KAAD,CAAP;AACH,OAPD;AASD;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACS,KA1IM,CAAP;AA2IH;AAIJ","sourcesContent":["import makeHttpError from '../helpers/http-error';\n\n//const nodemailer = require('nodemailer');\n\nconst sgMail = require('@sendgrid/mail')\n\nexport default function makeQuery () {\n\n    return async function handle(httpRequest){\n        let resp = await getMailer(httpRequest);\n        if(resp == true){\n            return {\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                statusCode: 200,\n                data: JSON.stringify(resp)\n              }\n        }\n        else {\n            return makeHttpError({\n                errorMessage: e.message,\n                statusCode:\n                  e instanceof UniqueConstraintError\n                    ? 409\n                    : e instanceof InvalidPropertyError ||\n                      e instanceof RequiredParameterError\n                      ? 400\n                      : 500\n              })\n        }\n        \n    }\n\n    async function getMailer (httpRequest) {\n        return new Promise((resolve,reject)=>{\n            let msgInfo = httpRequest.body\n            \n            if (!msgInfo) {\n                return makeHttpError({\n                statusCode: 400,\n                errorMessage: 'Bad request. No POST body.'\n                })\n            }\n\n            if (typeof httpRequest.body === 'string') {\n                try {\n                    msgInfo = JSON.parse(msgInfo)\n                } catch {\n                return makeHttpError({\n                    statusCode: 400,\n                    errorMessage: 'Bad request. POST body must be valid JSON.'\n                })\n                }\n            }\n    \n            \n\n            /*\n            const transporter = nodemailer.createTransport({\n                service: 'gmail',\n                auth: {\n                user: 'wongafixmail@gmail.com',\n                pass: '!321Wongafix_Admin',\n                },\n            });*/\n            \n\n            const template = `<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n            <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en-GB\">\n            <head>\n                <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n                <title>Wonder Double Season Greetings</title>\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n            \n                <style type=\"text/css\">\n                    @media screen {\n                    @font-face { \n                        font-family: 'Lato';\n                        font-style: normal;\n                        font-weight: 400;\n                        src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v11/qIIYRU-oROkIk8vfvxw6QvesZW2xOQ-xsNqO47m55DA.woff) format('woff');\n                    }\n                    \n                    body {\n                        font-family: \"Lato\", \"Lucida Grande\", \"Lucida Sans Unicode\", Tahoma, Sans-Serif;\n                    }\n                    }\n                </style>\n            </head>\n            <body style=\"margin: 0; padding: 0;\">\n                <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n                    <tr>\n                        <td>\n                            <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"600\" style=\"border-collapse: collapse; border: 1px solid #cccccc;\">\n                                <tr>\n                                    <td bgcolor=\"#edebea\" align=\"center\"  style=\"padding: 30px 10px;\">\n                                        <img src=\"https://wongafix-assets.s3.eu-west-1.amazonaws.com/email/small-logo.png\" alt=\"WonderDouble banner\" width=\"150\" title=\"\" style=\"display: block;\" />\n                                        \n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td bgcolor=\"#fff\" style=\"padding: 100px 30px;\">\n                                        \n                                        <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"border-collapse: collapse; color:#444\">\n                                            <tr>\n                                                <td style=\"padding: 0;\">\n                                                    <p style=\"margin: 0; font-family: Arial, sans-serif; text-align:left;\">`+msgInfo.message+`</h2>\n                                                </td>\n                                            </tr>\n                                        </table>    \n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td align=\"center\" bgcolor=\"#2fad51\" style=\"padding: 10px 0; color:#ffffff;\">\n                                        <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"  style=\"border-collapse: collapse;\">\n                                            <tr>\n                                                <td align=\"center\" valign=\"top\">\n                                                    <p>ADDRESS<br>Suite 13, Unique Shopping Mall, <br>Works Road, <br>GRA Ikeja, Lagos.<br><br><span style=\"font-size:14px;\">+234-905-815-4095<br> info@wongafix.com</span>\n                                                    </p>\n                                                </td> \n                                            </tr>\n                                        </table>\n                                        \n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td align=\"center\" bgcolor=\"#edebea\">\n                                    <p style=\"color:#343c64; font-size:14px;\">&copy Wongafix 2021</p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n            </body>\n            </html>`;\n\n            sgMail.setApiKey(process.env.SENDGRID_API_KEY)\n            const msg = {\n            to: msgInfo.email, // Change to your recipient\n            from: {\n                email: 'info@wongafix.com',\n                name: 'Wongafix'\n            },\n            \n            subject: msgInfo.topic,\n            text: msgInfo.message, // plain text body\n            html: template, // html body\n            }\n            sgMail\n            .send(msg)\n            .then(() => {\n                resolve(true);\n            })\n            .catch((error) => {\n                resolve(false);\n            })\n\n           /* transporter.sendMail({\n                from: '\"Wongafix\" <wongafixmail@gmail.com>', // sender address\n                to: msgInfo.email, // list of receivers\n                subject: msgInfo.topic, // Subject line\n                text: msgInfo.message, // plain text body\n                html: template, // html body\n                }, function(error, info){\n                    if (error) {\n                    resolve(false); // or use rejcet(false) but then you will have to handle errors\n                    } \n                else {\n                    resolve(true);\n                    }\n                });*/\n        })\n    }\n \n\n    \n}"],"file":"query.js"}